<% layout('layouts/boilerplate') %>
    <link rel="stylesheet" href="map.css">

    <section class="container-fluid px-0">
        <div class="row align-items-center mt-5">
            <div class="card mx-auto w-85 border-0">
                <div id="headingGroup" class="text-center d-none d-lg-block">
                    <h2 class="">School-based Physical Fitness Testing of California School Districts</h2>
                </div>
                <!-- <div id="headingGroup" class="text-center d-none d-lg-block">
                <h4>Legend: The lighter, the higher percentage (better); the darker, the lower percentage (worse)</h4>
            </div> -->
            </div>
        </div>

        <% if (messages.length> 0) { %>
            <div class="alert alert-danger alert-dismissible fade show" role="alert">
                <%= messages[0] %>
            </div>
            <% } %>

                <div class="row align-items-center mt-3">
                    <div class="card mx-auto w-80">
                        <div class="card-header">Display Options</div>
                        <div class="card-block">
                            <form id="display_options" action="/california" method="POST">
                                <div class="form-group row mt-2 align-items-center">
                                    <div class="col-md-4">
                                        <select class="form-select" name="item" id="item">
                                            <option value="" selected>--Fitness Assessment--</option>
                                            <option value="aero" <%=item==="aero" ? 'selected' : '' %>>Aerobic
                                                Capacity
                                            </option>
                                            <option value="body" <%=item==="body" ? 'selected' : '' %>>Body
                                                Composition
                                            </option>
                                            <option value="abd" <%=item==="abd" ? 'selected' : '' %>>Abdominal
                                                Strength
                                            </option>
                                            <option value="trunk" <%=item==="trunk" ? 'selected' : '' %>>Trunk
                                                Extension
                                                Strength</option>
                                            <option value="ub" <%=item==="ub" ? 'selected' : '' %>>Upper Body
                                                Strength
                                            </option>
                                            <option value="flex" <%=item==="flex" ? 'selected' : '' %>>Flexibility
                                            </option>
                                        </select>
                                    </div>
                                    <div class="col-md-4">
                                        <select class="form-select" name="grade" id="grade">
                                            <option value="" selected>--Grade Level--</option>
                                            <option value="5" <%=grade==="5" ? 'selected' : '' %>>Elementary (5th
                                                Grade)
                                            </option>
                                            <option value="7" <%=grade==="7" ? 'selected' : '' %>>Middle School (7th
                                                Grade)
                                            </option>
                                            <option value="9" <%=grade==="9" ? 'selected' : '' %>>High School (9th
                                                Grade)
                                            </option>
                                        </select>
                                    </div>
                                    <div class="col-md-4">
                                        <select class="form-select" name="year" id="year">
                                            <option value="" selected>--School Year--</option>
                                            <option value="1999" <%=year==="1999" ? 'selected' : '' %>>1998~1999
                                            </option>
                                            <% for (let i=2001; i<2020; i++) { %>
                                                <option value="<%= i %>" <%=year===i.toString() ? 'selected' : '' %>
                                                    ><%= (i-1).toString() %>~<%= i.toString() %>
                                                </option>
                                                <% } %>
                                        </select>
                                    </div>
                                </div>

                                <div class="form-group row mt-2 mb-2 align-items-center justify-content-end">
                                    <div class="col">
                                        <button type="button" class="btn btn-info" data-bs-toggle="modal"
                                            data-bs-target="#countyModal">Filter by County</button>
                                    </div>
                                    <div class="col-auto">
                                        <button type="submit" class="btn btn-primary">Confirm</button>
                                    </div>
                                </div>

                                <div class="modal fade" id="countyModal" tabindex="-1"
                                    aria-labelledby="countyModalLabel" aria-hidden="true">
                                    <div class="modal-dialog">
                                        <div class="modal-content">
                                            <div class="modal-header">
                                                <h5 class="modal-title" id="modalLabel">Filter by County</h5>
                                                <button type="button" class="btn-close" data-bs-dismiss="modal"
                                                    aria-label="Close"></button>
                                            </div>
                                            <div class="modal-body">
                                                <div class="form-group row mt-2 align-items-center">
                                                    <label>Please choose at least 1 county:</label>
                                                </div>
                                                <div class="form-group row mt-2 align-items-center">
                                                    <div>
                                                        <% const names=['Alameda', 'Alpine' , 'Amador' , 'Butte'
                                                            , 'Calaveras' , 'Colusa' , 'Contra Costa' , 'Del Norte'
                                                            , 'El Dorado' , 'Fresno' , 'Glenn' , 'Humboldt' , 'Imperial'
                                                            , 'Inyo' , 'Kern' , 'Kings' , 'Lake' , 'Lassen'
                                                            , 'Los Angeles' , 'Madera' , 'Marin' , 'Mariposa'
                                                            , 'Mendocino' , 'Merced' , 'Modoc' , 'Mono' , 'Monterey'
                                                            , 'Napa' , 'Nevada' , 'Orange' , 'Placer' , 'Plumas'
                                                            , 'Riverside' , 'Sacramento' , 'San Benito'
                                                            , 'San Bernardino' , 'San Diego' , 'San Francisco'
                                                            , 'San Joaquin' , 'San Luis Obispo' , 'San Mateo'
                                                            , 'Santa Barbara' , 'Santa Clara' , 'Santa Cruz' , 'Shasta'
                                                            , 'Sierra' , 'Siskiyou' , 'Solano' , 'Sonoma' , 'Stanislaus'
                                                            , 'Sutter' , 'Tehama' , 'Trinity' , 'Tulare' , 'Tuolumne'
                                                            , 'Ventura' , 'Yolo' , 'Yuba'] %>
                                                            <% for (let i=0; i<58; i++) { %>
                                                                <div class="form-check form-check-inline">
                                                                    <input class="form-check-input" type="checkbox"
                                                                        name="<%= (i+1).toString().padStart(2, '0') %>"
                                                                        id="<%= (i+1).toString().padStart(2, '0') %>"
                                                                        <%=checkboxStr.length> 0 &&
                                                                    checkboxStr.includes((i+1).toString().padStart(2, '0'
                                                                    )) ? 'checked' : '' %>>
                                                                    <label class="form-check-label"
                                                                        for="<%= (i+1).toString().padStart(2, '0') %>">
                                                                        <%=names[i] %>
                                                                    </label>
                                                                </div>
                                                                <% } %>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="modal-footer">
                                                <button type="button" class="btn btn-secondary"
                                                    data-bs-dismiss="modal">Close</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <input type="hidden" name="checkboxStr" id="checkbox_str">

                            </form>
                        </div>
                    </div>
                </div>
                <div class="row align-items-center mt-5">
                    <br>
                    <div id="map"></div>
                </div>

                <script src="https://code.jquery.com/jquery-3.6.3.min.js"
                    integrity="sha256-pvPw+upLPUjgMXY0G+8O0xUf+/Im1MZjXxxgOcBQBXU=" crossorigin="anonymous"></script>
                <script src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js"
                    integrity="sha256-WBkoXOwTeyKclOHuWtc+i2uENFpDZ9YPdf5Hf+D7ewM=" crossorigin=""></script>
                <script src="/node_modules/leaflet-geoserver-request/src/L.Geoserver.js"></script>
                <script src="parseform.js"></script>
                <script>
                    const grade_str = '<%- grade %>';
                    const item_str = '<%- item %>';
                    const year_str = '<%- year %>';
                    const checkbox = '<%- checkboxStr %>'
                </script>
                <script src="map.js"></script>
    </section>